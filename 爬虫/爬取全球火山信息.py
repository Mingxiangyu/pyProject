import requests
from fake_useragent import UserAgent
from lxml import etree

volcano_number_list = [210010,
                       210020,
                       210030,
                       210040,
                       211004,
                       211010,
                       211020,
                       211030,
                       211031,
                       211040,
                       211041,
                       211042,
                       211050,
                       211060,
                       211070,
                       211071,
                       211080,
                       212020,
                       212030,
                       212040,
                       212050,
                       212051,
                       213000,
                       213001,
                       213002,
                       213003,
                       213004,
                       213010,
                       213011,
                       213020,
                       213030,
                       213040,
                       214010,
                       214020,
                       214050,
                       214060,
                       214070,
                       214080,
                       214090,
                       214100,
                       221010,
                       221020,
                       221021,
                       221022,
                       221040,
                       221041,
                       221050,
                       221060,
                       221071,
                       221080,
                       221090,
                       221091,
                       221100,
                       221101,
                       221102,
                       221103,
                       221104,
                       221105,
                       221106,
                       221107,
                       221110,
                       221111,
                       221112,
                       221113,
                       221114,
                       221115,
                       221116,
                       221120,
                       221122,
                       221123,
                       221124,
                       221125,
                       221126,
                       221127,
                       221141,
                       221150,
                       221151,
                       221160,
                       221170,
                       221171,
                       221172,
                       221180,
                       221190,
                       221191,
                       221200,
                       221210,
                       221220,
                       221222,
                       221230,
                       221240,
                       221250,
                       221251,
                       221252,
                       221260,
                       221270,
                       221280,
                       221290,
                       221291,
                       221292,
                       221294,
                       221311,
                       221320,
                       221330,
                       222001,
                       222010,
                       222020,
                       222021,
                       222030,
                       222040,
                       222050,
                       222051,
                       222052,
                       222053,
                       222054,
                       222055,
                       222056,
                       222060,
                       222070,
                       222071,
                       222080,
                       222090,
                       222100,
                       222110,
                       222120,
                       222130,
                       222160,
                       222161,
                       222164,
                       222166,
                       222170,
                       223001,
                       223002,
                       223003,
                       223004,
                       223005,
                       223020,
                       223030,
                       223040,
                       223050,
                       223060,
                       223070,
                       224002,
                       224003,
                       224004,
                       224010,
                       224011,
                       224030,
                       225001,
                       225004,
                       225005,
                       225006,
                       225009,
                       225010,
                       225020,
                       225021,
                       225030,
                       225040,
                       225050,
                       225060,
                       231001,
                       231040,
                       231050,
                       231060,
                       231070,
                       231071,
                       231072,
                       231080,
                       231090,
                       231100,
                       231110,
                       231120,
                       231160,
                       231170,
                       231180,
                       232001,
                       232002,
                       232010,
                       232030,
                       232040,
                       232050,
                       233001,
                       233005,
                       233010,
                       233011,
                       233012,
                       233013,
                       233014,
                       233015,
                       233020,
                       234000,
                       234001,
                       234002,
                       234010,
                       234011,
                       234020,
                       234030,
                       234040,
                       234050,
                       234060,
                       234070,
                       241010,
                       241020,
                       241021,
                       241030,
                       241040,
                       241050,
                       241070,
                       241080,
                       241100,
                       241101,
                       241102,
                       241110,
                       241120,
                       241130,
                       241131,
                       241140,
                       241150,
                       242001,
                       242005,
                       242010,
                       242021,
                       242022,
                       242030,
                       242050,
                       243001,
                       243010,
                       243011,
                       243030,
                       243040,
                       243050,
                       243060,
                       243061,
                       243070,
                       243080,
                       243090,
                       243091,
                       243100,
                       243101,
                       243102,
                       243110,
                       243111,
                       243112,
                       243120,
                       243130,
                       243140,
                       244000,
                       244001,
                       244010,
                       244020,
                       244021,
                       244030,
                       244040,
                       245010,
                       245020,
                       245030,
                       250010,
                       250020,
                       250030,
                       251001,
                       251002,
                       251010,
                       251011,
                       251020,
                       251030,
                       251041,
                       251050,
                       251060,
                       251070,
                       251080,
                       252010,
                       252021,
                       252030,
                       252040,
                       252050,
                       252060,
                       252070,
                       252071,
                       252080,
                       252090,
                       252100,
                       252110,
                       252120,
                       252130,
                       252140,
                       252150,
                       253010,
                       253011,
                       253021,
                       253030,
                       253031,
                       253040,
                       253041,
                       253050,
                       253060,
                       254010,
                       254020,
                       255010,
                       255011,
                       255020,
                       255021,
                       255030,
                       255050,
                       255052,
                       255053,
                       255060,
                       255061,
                       255062,
                       255070,
                       256010,
                       257001,
                       257010,
                       257020,
                       257021,
                       257030,
                       257040,
                       257050,
                       257060,
                       257070,
                       257080,
                       257081,
                       257090,
                       257100,
                       257110,
                       258001,
                       258010,
                       258020,
                       259010,
                       259804,
                       260001,
                       260010,
                       261020,
                       261030,
                       261050,
                       261070,
                       261080,
                       261090,
                       261110,
                       261111,
                       261120,
                       261121,
                       261130,
                       261131,
                       261140,
                       261150,
                       261160,
                       261170,
                       261180,
                       261200,
                       261210,
                       261220,
                       261230,
                       261231,
                       261251,
                       261260,
                       261270,
                       261280,
                       261290,
                       262000,
                       263010,
                       263020,
                       263040,
                       263050,
                       263060,
                       263070,
                       263090,
                       263100,
                       263110,
                       263130,
                       263131,
                       263140,
                       263150,
                       263170,
                       263180,
                       263200,
                       263210,
                       263220,
                       263230,
                       263231,
                       263240,
                       263250,
                       263251,
                       263260,
                       263270,
                       263280,
                       263281,
                       263290,
                       263291,
                       263300,
                       263310,
                       263320,
                       263330,
                       263340,
                       263350,
                       263351,
                       264001,
                       264010,
                       264020,
                       264030,
                       264040,
                       264050,
                       264060,
                       264071,
                       264080,
                       264090,
                       264100,
                       264110,
                       264140,
                       264150,
                       264160,
                       264180,
                       264200,
                       264220,
                       264230,
                       264240,
                       264250,
                       264260,
                       264270,
                       265040,
                       265050,
                       265060,
                       265070,
                       265080,
                       265090,
                       266010,
                       266020,
                       266030,
                       266100,
                       266110,
                       266120,
                       266130,
                       267010,
                       267020,
                       267030,
                       267040,
                       268001,
                       268010,
                       268020,
                       268030,
                       268040,
                       268050,
                       268051,
                       268052,
                       268060,
                       268061,
                       268062,
                       268063,
                       268070,
                       268071,
                       268072,
                       268073,
                       271010,
                       271011,
                       271020,
                       271030,
                       271031,
                       271040,
                       271060,
                       271061,
                       271070,
                       271071,
                       271080,
                       272010,
                       272020,
                       272030,
                       272040,
                       272050,
                       272070,
                       272080,
                       273010,
                       273020,
                       273030,
                       273031,
                       273041,
                       273042,
                       273044,
                       273050,
                       273060,
                       273070,
                       273080,
                       273083,
                       273087,
                       273088,
                       273090,
                       274010,
                       274020,
                       274030,
                       274050,
                       274060,
                       275001,
                       275020,
                       275060,
                       275080,
                       275110,
                       281031,
                       281032,
                       282010,
                       282020,
                       282021,
                       282022,
                       282030,
                       282040,
                       282043,
                       282050,
                       282060,
                       282070,
                       282080,
                       282081,
                       282090,
                       282091,
                       282100,
                       282110,
                       282120,
                       282130,
                       283001,
                       283002,
                       283003,
                       283010,
                       283020,
                       283030,
                       283031,
                       283040,
                       283050,
                       283060,
                       283069,
                       283070,
                       283071,
                       283080,
                       283090,
                       283100,
                       283110,
                       283120,
                       283121,
                       283122,
                       283130,
                       283131,
                       283140,
                       283141,
                       283142,
                       283143,
                       283150,
                       283151,
                       283160,
                       283170,
                       283180,
                       283190,
                       283191,
                       283200,
                       283210,
                       283220,
                       283230,
                       283240,
                       283250,
                       283260,
                       283262,
                       283270,
                       283271,
                       283280,
                       283290,
                       284010,
                       284011,
                       284020,
                       284030,
                       284040,
                       284041,
                       284042,
                       284050,
                       284060,
                       284061,
                       284070,
                       284080,
                       284090,
                       284091,
                       284093,
                       284094,
                       284095,
                       284096,
                       284097,
                       284100,
                       284110,
                       284120,
                       284121,
                       284130,
                       284131,
                       284132,
                       284133,
                       284134,
                       284135,
                       284136,
                       284137,
                       284140,
                       284141,
                       284142,
                       284143,
                       284150,
                       284160,
                       284170,
                       284180,
                       284190,
                       284191,
                       284192,
                       284193,
                       284200,
                       284201,
                       284202,
                       284210,
                       284211,
                       284220,
                       284230,
                       284305,
                       285010,
                       285011,
                       285020,
                       285030,
                       285031,
                       285032,
                       285034,
                       285040,
                       285041,
                       285050,
                       285060,
                       285061,
                       285070,
                       285080,
                       285081,
                       285082,
                       285083,
                       285090,
                       290010,
                       290020,
                       290021,
                       290030,
                       290040,
                       290041,
                       290050,
                       290060,
                       290061,
                       290070,
                       290072,
                       290080,
                       290090,
                       290100,
                       290110,
                       290111,
                       290112,
                       290113,
                       290120,
                       290150,
                       290160,
                       290161,
                       290180,
                       290190,
                       290191,
                       290200,
                       290210,
                       290211,
                       290220,
                       290240,
                       290250,
                       290260,
                       290270,
                       290290,
                       290300,
                       290310,
                       290320,
                       290331,
                       290340,
                       290350,
                       290360,
                       290370,
                       290380,
                       290390,
                       300010,
                       300020,
                       300021,
                       300022,
                       300023,
                       300030,
                       300040,
                       300050,
                       300052,
                       300053,
                       300058,
                       300059,
                       300060,
                       300070,
                       300080,
                       300082,
                       300083,
                       300084,
                       300090,
                       300100,
                       300110,
                       300120,
                       300121,
                       300122,
                       300123,
                       300124,
                       300125,
                       300130,
                       300140,
                       300150,
                       300160,
                       300170,
                       300180,
                       300190,
                       300200,
                       300210,
                       300220,
                       300221,
                       300230,
                       300240,
                       300241,
                       300242,
                       300250,
                       300251,
                       300260,
                       300261,
                       300270,
                       300271,
                       300272,
                       300273,
                       300280,
                       300310,
                       300360,
                       300450,
                       300511,
                       300512,
                       300520,
                       300550,
                       300551,
                       300552,
                       300560,
                       300590,
                       300650,
                       300671,
                       300680,
                       300700,
                       300720,
                       302030,
                       302040,
                       302050,
                       302060,
                       302070,
                       303010,
                       303020,
                       303040,
                       304030,
                       305010,
                       305011,
                       305020,
                       305030,
                       305040,
                       305050,
                       305060,
                       306020,
                       306030,
                       306040,
                       311010,
                       311020,
                       311030,
                       311040,
                       311050,
                       311060,
                       311070,
                       311080,
                       311090,
                       311100,
                       311110,
                       311111,
                       311120,
                       311130,
                       311140,
                       311160,
                       311180,
                       311190,
                       311200,
                       311210,
                       311220,
                       311230,
                       311240,
                       311241,
                       311250,
                       311260,
                       311270,
                       311280,
                       311290,
                       311300,
                       311310,
                       311320,
                       311340,
                       311350,
                       311360,
                       311380,
                       311390,
                       312010,
                       312011,
                       312020,
                       312030,
                       312040,
                       312050,
                       312055,
                       312060,
                       312070,
                       312080,
                       312090,
                       312100,
                       312110,
                       312120,
                       312130,
                       312131,
                       312132,
                       312140,
                       312150,
                       312160,
                       312170,
                       312180,
                       312190,
                       312200,
                       312210,
                       312220,
                       312230,
                       312250,
                       312260,
                       312270,
                       313010,
                       313020,
                       313030,
                       313040,
                       313050,
                       314010,
                       314030,
                       314040,
                       314060,
                       315001,
                       315020,
                       315030,
                       315040,
                       315050,
                       315060,
                       315070,
                       320010,
                       320020,
                       320030,
                       320031,
                       320040,
                       320050,
                       320060,
                       320070,
                       320080,
                       320090,
                       320100,
                       320110,
                       320120,
                       320140,
                       320150,
                       320160,
                       320170,
                       320180,
                       320190,
                       320200,
                       320811,
                       321010,
                       321020,
                       321030,
                       321040,
                       321050,
                       321060,
                       321070,
                       322010,
                       322020,
                       322030,
                       322040,
                       322060,
                       322070,
                       322090,
                       322100,
                       322110,
                       322120,
                       322150,
                       322160,
                       322170,
                       322190,
                       323010,
                       323020,
                       323080,
                       323100,
                       323110,
                       323120,
                       323150,
                       323160,
                       323200,
                       324010,
                       324020,
                       324030,
                       324040,
                       326010,
                       327040,
                       327050,
                       327110,
                       327120,
                       327812,
                       328010,
                       329010,
                       329020,
                       331005,
                       331010,
                       331011,
                       331020,
                       331021,
                       331030,
                       331031,
                       331032,
                       331040,
                       331060,
                       332000,
                       332010,
                       332020,
                       332030,
                       332040,
                       332060,
                       333010,
                       333020,
                       333030,
                       333040,
                       333050,
                       333060,
                       334020,
                       334021,
                       334040,
                       334050,
                       334070,
                       334100,
                       334120,
                       334130,
                       334140,
                       335020,
                       335030,
                       341000,
                       341001,
                       341003,
                       341004,
                       341005,
                       341006,
                       341007,
                       341011,
                       341012,
                       341020,
                       341021,
                       341022,
                       341023,
                       341024,
                       341030,
                       341031,
                       341040,
                       341060,
                       341061,
                       341062,
                       341070,
                       341080,
                       341081,
                       341082,
                       341090,
                       341091,
                       341092,
                       341093,
                       341094,
                       341095,
                       341096,
                       341097,
                       341098,
                       341100,
                       341110,
                       341120,
                       341130,
                       342020,
                       342030,
                       342040,
                       342060,
                       342070,
                       342080,
                       342090,
                       342100,
                       342110,
                       342111,
                       342120,
                       342121,
                       342130,
                       342140,
                       342141,
                       342150,
                       342160,
                       342170,
                       342180,
                       342190,
                       342200,
                       343001,
                       343002,
                       343010,
                       343020,
                       343030,
                       343041,
                       343050,
                       343051,
                       343052,
                       343060,
                       343070,
                       343071,
                       343072,
                       343080,
                       343081,
                       343082,
                       343090,
                       343100,
                       343101,
                       343130,
                       343140,
                       343150,
                       344010,
                       344020,
                       344040,
                       344060,
                       344070,
                       344080,
                       344090,
                       344091,
                       344092,
                       344100,
                       344101,
                       344110,
                       344111,
                       344120,
                       344131,
                       344132,
                       344133,
                       345010,
                       345020,
                       345030,
                       345031,
                       345033,
                       345034,
                       345040,
                       345050,
                       345060,
                       345070,
                       346010,
                       346030,
                       351011,
                       351012,
                       351020,
                       351021,
                       351030,
                       351040,
                       351050,
                       351060,
                       351061,
                       351070,
                       351080,
                       351090,
                       351100,
                       351110,
                       352001,
                       352002,
                       352003,
                       352004,
                       352005,
                       352006,
                       352010,
                       352011,
                       352020,
                       352021,
                       352022,
                       352030,
                       352031,
                       352040,
                       352041,
                       352050,
                       352060,
                       352071,
                       352080,
                       352081,
                       352090,
                       353010,
                       353011,
                       353020,
                       353030,
                       353040,
                       353050,
                       353060,
                       353070,
                       353080,
                       353081,
                       353090,
                       353091,
                       353120,
                       354000,
                       354001,
                       354002,
                       354003,
                       354004,
                       354005,
                       354006,
                       354007,
                       354008,
                       354010,
                       354020,
                       354030,
                       354031,
                       354040,
                       354050,
                       354060,
                       355010,
                       355011,
                       355012,
                       355020,
                       355021,
                       355030,
                       355032,
                       355035,
                       355036,
                       355040,
                       355050,
                       355090,
                       355091,
                       355092,
                       355093,
                       355094,
                       355095,
                       355096,
                       355098,
                       355100,
                       355101,
                       355102,
                       355103,
                       355104,
                       355105,
                       355107,
                       355108,
                       355109,
                       355110,
                       355112,
                       355120,
                       355121,
                       355122,
                       355123,
                       355124,
                       355125,
                       355130,
                       355131,
                       355150,
                       355160,
                       355161,
                       355180,
                       355190,
                       355200,
                       355210,
                       355220,
                       356011,
                       357010,
                       357020,
                       357021,
                       357022,
                       357023,
                       357024,
                       357030,
                       357040,
                       357041,
                       357042,
                       357050,
                       357060,
                       357061,
                       357062,
                       357063,
                       357064,
                       357065,
                       357066,
                       357070,
                       357072,
                       357080,
                       357081,
                       357090,
                       357091,
                       357093,
                       357100,
                       357102,
                       357110,
                       357111,
                       357112,
                       357120,
                       357121,
                       357122,
                       357123,
                       357130,
                       357140,
                       357150,
                       357153,
                       357160,
                       358010,
                       358011,
                       358012,
                       358020,
                       358022,
                       358023,
                       358024,
                       358025,
                       358030,
                       358040,
                       358041,
                       358049,
                       358050,
                       358052,
                       358053,
                       358054,
                       358055,
                       358056,
                       358057,
                       358060,
                       358062,
                       358063,
                       358064,
                       358070,
                       358080,
                       358090,
                       360010,
                       360020,
                       360030,
                       360040,
                       360050,
                       360060,
                       360080,
                       360090,
                       360100,
                       360101,
                       360110,
                       360120,
                       360140,
                       360150,
                       360160,
                       360170,
                       370010,
                       370020,
                       370030,
                       371020,
                       371022,
                       371030,
                       371032,
                       371040,
                       371050,
                       371051,
                       371060,
                       371070,
                       371080,
                       371090,
                       372010,
                       372020,
                       372030,
                       372040,
                       372050,
                       372070,
                       373010,
                       373012,
                       373030,
                       373040,
                       373050,
                       373060,
                       373070,
                       373080,
                       373082,
                       373090,
                       373100,
                       374010,
                       374020,
                       374801,
                       375010,
                       376010,
                       377020,
                       381040,
                       382001,
                       382010,
                       382020,
                       382030,
                       382040,
                       382050,
                       382070,
                       382080,
                       382081,
                       382090,
                       382100,
                       382110,
                       382120,
                       383010,
                       383020,
                       383030,
                       383040,
                       383050,
                       383060,
                       384010,
                       384020,
                       385030,
                       385050,
                       385052,
                       386010,
                       386011,
                       386020,
                       390010,
                       390011,
                       390012,
                       390013,
                       390015,
                       390016,
                       390017,
                       390020,
                       390021,
                       390022,
                       390023,
                       390027,
                       390028,
                       390030,
                       390031,
                       390040,
                       390041,
                       390070,
                       390080,
                       390081,
                       390090,
                       390100,
                       390110,
                       390120,
                       390130,
                       390140,
                       390829,
                       390847,
                       ]


class volcanoDownload(object):

    def __init__(self):
        self.url = "https://volcano.si.edu/volcano.cfm?vn={}"
        ua = UserAgent(verify_ssl=False)
        for i in range(1, 100):
            # 产生随机的User - Agent请求头进行访问
            self.headers = {
                'User-Agent': ua.random
            }

    # 请求网站获取url
    def get_html(self, url) -> str:
        # toDo 添加代理，更新反扒
        response = requests.get(url, headers=self.headers)
        html = response.text
        return html

    # 解析url，获取数据
    def parse_html(self, html):
        target = etree.HTML(html)

        volcano_info_dict = {}
        volcano_info_title_table = target.xpath('//div[@class="volcano-info-table"]//li[@class="title"]')
        volcano_info_shaded_table = target.xpath('//div[@class="volcano-info-table"]//li[@class="shaded"]')
        for i in range(len(volcano_info_title_table)):
            key = str(volcano_info_title_table[i].xpath("./text()")[0])
            if key == ' ':
                break
            if key == "Country":
                value = str(volcano_info_shaded_table[i].xpath("./a/text()")[0])
            else:
                value = str(volcano_info_shaded_table[i].xpath("./text()")[0])

            volcano_info_dict[key] = value
            # print(key)
            # print(value)

        volcano_subinfo_title_table = target.xpath('//div[@class="volcano-subinfo-table"]//li[@class="title"]')
        volcano_subinfo_clear_table = target.xpath('//div[@class="volcano-subinfo-table"]//li[@class="clear"]')
        for i in range(len(volcano_subinfo_title_table)):
            key_list = volcano_subinfo_title_table[i].xpath("./text()")
            if not key_list:
                continue
            if len(key_list) > 1:
                # 将该标签下两个元素拼接为一个字符串
                key = " ".join(key_list)
            else:
                key = str(key_list[0])
            value = str(volcano_subinfo_clear_table[i].xpath("./text()")[0])

            volcano_info_dict[key] = value
            # print(key)
            # print(value)

        volcano_image = str(target.xpath('//img[@class="volcano-image"]/@src')[0])
        volcano_image = volcano_image.replace("photos", "thumbs")  # 原volcano_image 为大图，为减少网络消耗，修改为thumbs
        image_url = "https://volcano.si.edu" + volcano_image
        volcano_info_dict["image_url"] = image_url

        volcano_name = str(target.xpath('//div[@class="volcano-title-container"]/h3/text()')[0])
        volcano_info_dict["volcano_name"] = volcano_name

        return volcano_info_dict

        # toDo 暂定图片不下载，直接在线展示
        # response = requests.get(image_url, headers=self.headers)
        # # 数据下载
        # imageDir = "./volcanoImage"
        # if not os.path.exists(imageDir):
        #     os.makedirs(imageDir)
        # image_name = image_url.split("/")[-1]
        # imagePath = imageDir + "/" + image_name
        # print(imagePath)
        # with open(imagePath, "wb") as code:
        #     # requests.get(url)默认是下载在内存中的，下载完成才存到硬盘上，可以用Response.iter_content来边下载边存硬盘
        #     for chunk in response.iter_content(chunk_size=1024):
        #         code.write(chunk)

    def main(self):
        for i in range(len(volcano_number_list)):
            if i > 50:
                return
            volcano_number = volcano_number_list[i]
            url = self.url.format(volcano_number)
            print("start download html:{}".format(url))
            html = self.get_html(url)
            volcano_info_dict = self.parse_html(html)
            print(volcano_info_dict)


if __name__ == '__main__':
    spider = volcanoDownload()
    spider.main()
